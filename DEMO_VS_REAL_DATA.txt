â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                                                                    â•‘
â•‘           DEMO MODE vs REAL DATA - HOW IT WORKS                   â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•


CURRENT SITUATION (Demo Mode):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Your App          â”‚
    â”‚   (FastAPI)         â”‚
    â”‚                     â”‚
    â”‚  ğŸ“Š Dashboard       â”‚â—„â”€â”€â”€ Shows FAKE data
    â”‚  ğŸ’¾ SQLite DB       â”‚â—„â”€â”€â”€ Contains 30 synthetic invoices
    â”‚                     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â–²
              â”‚
              â”‚ Reads from
              â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  seed_demo.py       â”‚â”€â”€â”€â”€ Generated fake invoices
    â”‚  (Demo Data)        â”‚     (not real transactions)
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    âš ï¸  Problem: No connection to real Bitcoin payments
    âš ï¸  All data is synthetic and for testing only


AFTER CONNECTING BTCPAY (Real Data):
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  BTCPay Server               â”‚
    â”‚  (Your Bitcoin Gateway)      â”‚
    â”‚                              â”‚
    â”‚  ğŸª Your Store               â”‚
    â”‚  ğŸ’° Real BTC Invoices        â”‚
    â”‚  ğŸ’³ Payment Processing       â”‚
    â”‚  ğŸª Webhooks                 â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ API Calls (HTTPS)
                   â”‚ Webhooks (Real-time)
                   â”‚
                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Your App (FastAPI)         â”‚
    â”‚                              â”‚
    â”‚  ğŸ”‘ .env file configured     â”‚â—„â”€â”€â”€ API Key + Store ID
    â”‚  ğŸ“Š Dashboard                â”‚â—„â”€â”€â”€ Shows REAL invoices
    â”‚  ğŸ’¾ SQLite DB (cache)        â”‚â—„â”€â”€â”€ Stores real data locally
    â”‚  ğŸ”„ Refresh Data button      â”‚â—„â”€â”€â”€ Fetches latest from BTCPay
    â”‚  ğŸª Webhook endpoint         â”‚â—„â”€â”€â”€ Receives real-time updates
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


WHAT YOU NEED TO CONNECT:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                                                             â”‚
    â”‚  .env file with 4 values:                                   â”‚
    â”‚  â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                                â”‚
    â”‚                                                             â”‚
    â”‚  1. BTCPAY_HOST                                             â”‚
    â”‚     â””â”€â†’ Your BTCPay server domain                           â”‚
    â”‚         Example: mybtcpay.com                               â”‚
    â”‚                                                             â”‚
    â”‚  2. BTCPAY_API_KEY                                          â”‚
    â”‚     â””â”€â†’ API key with store permissions                      â”‚
    â”‚         Create in: Account â†’ API Keys                       â”‚
    â”‚                                                             â”‚
    â”‚  3. BTCPAY_STORE_ID                                         â”‚
    â”‚     â””â”€â†’ Your store's unique ID                              â”‚
    â”‚         Find in: Store URL or Settings                      â”‚
    â”‚                                                             â”‚
    â”‚  4. BTCPAY_WEBHOOK_SECRET                                   â”‚
    â”‚     â””â”€â†’ Secret string for webhook verification              â”‚
    â”‚         Create any random string                            â”‚
    â”‚                                                             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


DATA FLOW WITH BTCPAY CONNECTED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Customer makes payment
          â”‚
          â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  BTCPay Server â”‚
    â”‚  processes     â”‚
    â”‚  Bitcoin       â”‚
    â”‚  payment       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚              â”‚
             â–¼              â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Webhook    â”‚   â”‚  API Poll    â”‚
    â”‚  (instant)  â”‚   â”‚  (on refresh)â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                 â”‚
           â”‚                 â”‚
           â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  Your App                      â”‚
    â”‚  â€¢ Verifies HMAC signature     â”‚
    â”‚  â€¢ Updates database            â”‚
    â”‚  â€¢ Shows on dashboard          â”‚
    â”‚  â€¢ Updates analytics/charts    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


HOW DEMO MODE IS DETECTED:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  config.py checks:   â”‚
    â”‚                      â”‚
    â”‚  if BTCPAY_HOST      â”‚â”€â”€â”€â”€â”€â”€â–º Set? â”€â”€â”
    â”‚     is configured    â”‚               â”‚
    â”‚                      â”‚               â”‚
    â”‚  AND                 â”‚               â”‚
    â”‚                      â”‚               â”‚
    â”‚  if BTCPAY_STORE_ID  â”‚               â”‚
    â”‚     is configured    â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
                                           â”‚
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚                                   â”‚
                        â–¼ YES                               â–¼ NO
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  Real Data Mode  â”‚              â”‚   Demo Mode      â”‚
              â”‚                  â”‚              â”‚                  â”‚
              â”‚  â€¢ No banner     â”‚              â”‚  â€¢ Yellow banner â”‚
              â”‚  â€¢ Real invoices â”‚              â”‚  â€¢ Fake data     â”‚
              â”‚  â€¢ Live updates  â”‚              â”‚  â€¢ Seeded data   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


STEP-BY-STEP CONNECTION PROCESS:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Step 1: Get BTCPay Access
    â”œâ”€â†’ Option A: Use existing BTCPay Server
    â”œâ”€â†’ Option B: Sign up for hosted BTCPay (BTCPay Jungle, etc.)
    â””â”€â†’ Option C: Use public demo server for testing

    Step 2: Create API Key
    â”œâ”€â†’ Log into BTCPay Server
    â”œâ”€â†’ Go to Account â†’ API Keys
    â”œâ”€â†’ Generate key with store permissions
    â””â”€â†’ Copy the API key

    Step 3: Get Store ID
    â”œâ”€â†’ Go to your Store in BTCPay
    â”œâ”€â†’ Look at URL: /stores/{STORE_ID}/...
    â””â”€â†’ Copy the Store ID

    Step 4: Configure Your App
    â”œâ”€â†’ Run: python3 setup_btcpay.py
    â”œâ”€â†’ OR manually create .env file
    â””â”€â†’ Fill in all 4 values

    Step 5: Restart App
    â”œâ”€â†’ pkill -f uvicorn
    â”œâ”€â†’ uvicorn app.main:app --reload
    â””â”€â†’ Demo mode is now OFF!

    Step 6: Test
    â”œâ”€â†’ curl http://localhost:8000/health
    â”œâ”€â†’ Should show: "mode": "btcpay"
    â””â”€â†’ Dashboard shows real invoices

    Step 7: Set Up Webhooks (Optional but Recommended)
    â”œâ”€â†’ In BTCPay: Store â†’ Webhooks â†’ Create
    â”œâ”€â†’ Use same secret from .env file
    â””â”€â†’ Get real-time invoice updates


SECURITY NOTE:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    âš ï¸  NEVER commit .env file to git!

    The .gitignore file already excludes it:
    
    âœ“ .env        â† Your secrets (excluded)
    âœ“ .env.example â† Template only (safe to commit)

    Your API key gives access to your BTCPay store!
    Keep it secret, keep it safe.


TROUBLESHOOTING:
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

    Issue                           Fix
    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    Still shows demo mode          â†’ Check .env file exists
                                   â†’ Verify credentials are correct
                                   â†’ Restart the application

    "Unauthorized" error           â†’ Regenerate API key in BTCPay
                                   â†’ Check permissions are enabled

    No invoices appear             â†’ Your store may be empty
                                   â†’ Create test invoice in BTCPay
                                   â†’ Click "Refresh Data" button

    Webhook not working            â†’ Check webhook URL is correct
                                   â†’ Verify webhook secret matches
                                   â†’ Check BTCPay webhook logs


â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                Ready to connect? Run: python3 setup_btcpay.py
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
